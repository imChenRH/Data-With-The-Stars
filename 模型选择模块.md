# 模型选择模块
## MCM 2026 Problem C: Data With The Stars

> **设计原则**：针对每个小问提供「基础保分方案」+「创新冲奖方案」双轨策略，所有模型紧扣DWTS数据特征，禁止脱离数据实际的纯理论堆砌。

---

## 一、问题一：粉丝投票估算模型

### 1.1 问题特征分析

| 维度 | 数据特征 | 建模影响 |
|------|----------|----------|
| **问题类型** | 逆向推断（Inverse Problem） | 需约束优化而非直接回归 |
| **已知量** | 评委分数J、淘汰结果E | 构成约束条件 |
| **未知量** | 粉丝投票F（隐变量） | 需估算后验分布 |
| **数据约束** | ΣFi = 1（投票占比） | 单纯形约束 |
| **规则约束** | 排名制/百分比制交替 | 需分阶段建模 |

---

### 方案一（基础保分）：约束优化模型 + 先验正则化

#### 核心原理

约束优化模型将"粉丝投票估算"转化为一个**带不等式约束的优化问题**。核心思想是：我们知道谁被淘汰了（约束条件），需要找到一组粉丝投票使得这个淘汰结果成立，同时让投票分布尽量"合理"（目标函数）。

**通俗解释**：就像破案一样——我们知道犯罪结果（淘汰者），也有部分线索（评委分），要反推出"凶手"（粉丝投票）必须满足的条件。在所有可能的嫌疑人中，选择最"合理"的那个。

**数学形式**：

目标函数：min Σ(Fi - Fi_hat)²

约束条件：
- ΣFi = 1（投票比例和为1）
- Fi ≥ 0（非负约束）
- 淘汰约束（百分比制）：0.5JL + 0.5FL < 0.5Jk + 0.5Fk, ∀k ≠ L

其中Fi_hat为先验估计（如按评委分比例分配）。

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 连续型投票比例 | ✅ 凸优化天然处理连续变量 |
| 单纯形约束 | ✅ cvxpy内置支持 |
| 季节规则切换 | ✅ 约束条件可动态调整 |
| 多周数据 | ✅ 每周独立求解，计算高效 |

#### 创新点

1. **先验正则化**：引入Fi_hat = Ji作为先验（假设观众倾向给高分选手投票），避免纯随机解
2. **松弛变量引入**：对于约束冲突情况，添加松弛变量ε，将硬约束转为软约束
3. **多解处理**：当存在多个可行解时，选择方差最小的解（最保守估计）

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 解不唯一 | 引入先验正则化缩小解空间 |
| 排名制为离散约束 | 连续松弛后离散化处理 |
| 无法给出不确定性 | 结合Bootstrap采样估计置信区间 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     约束优化模型应用流程                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 数据场景抽象 │────►│ 数据预处理  │────►│  特征工程   │                   │
│  │             │     │             │     │             │                   │
│  │ •识别周数   │     │ •0分标记    │     │ •计算J占比  │                   │
│  │ •确定规则   │     │ •N/A剔除    │     │ •提取淘汰者 │                   │
│  │ •抽象约束   │     │ •归一化分数 │     │ •构建先验   │                   │
│  └─────────────┘     └─────────────┘     └─────────────┘                   │
│        │                   │                   │                           │
│        ▼                   ▼                   ▼                           │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │                    模型构建阶段                         │                 │
│  │  ┌─────────────────────────────────────────────────┐  │                 │
│  │  │ 1. 定义决策变量 F = [F1, F2, ..., Fn]           │  │                 │
│  │  │ 2. 设置目标函数 min Σ(Fi - Fi_hat)²             │  │                 │
│  │  │ 3. 添加单纯形约束 ΣFi=1, Fi≥0                   │  │                 │
│  │  │ 4. 添加淘汰约束（按season选择规则）              │  │                 │
│  │  └─────────────────────────────────────────────────┘  │                 │
│  └───────────────────────────────────────────────────────┘                 │
│        │                                                                   │
│        ▼                                                                   │
│  ┌─────────────┐     ┌─────────────────────────────────┐                   │
│  │  求解优化   │────►│          结果验证                │                   │
│  │             │     │                                 │                   │
│  │ •cvxpy求解 │     │ 模型是否有可行解？               │                   │
│  │ •记录状态  │     │    │                            │                   │
│  └─────────────┘     │    ├──►是：验证淘汰一致性      │                   │
│                      │    │      │                    │                   │
│                      │    │      ▼                    │                   │
│                      │    │   一致率>95%？            │                   │
│                      │    │      │                    │                   │
│                      │    │      ├──►是：输出结果     │                   │
│                      │    │      └──►否：调整先验     │                   │
│                      │    │                            │                   │
│                      │    └──►否：添加松弛变量重解    │                   │
│                      └─────────────────────────────────┘                   │
│        │                                                                   │
│        ▼                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 估算投票矩阵（选手×周）                                   │           │
│  │  • 一致性验证报告（准确率）                                  │           │
│  │  • 松弛变量报告（标识异常周）                                │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 方案二（创新冲奖）：贝叶斯MCMC + 狄利克雷先验

#### 核心原理

贝叶斯方法将问题转化为**后验概率估计**：不是求一个确定的投票值，而是估算投票的**概率分布**P(F|J,E)。这完美回应了题目对"Certainty（确定性）"的要求。

**通俗解释**：约束优化给你一个"最可能的答案"，贝叶斯方法给你一个"答案的可能性地图"——不仅告诉你最可能是什么，还告诉你有多大把握。

**贝叶斯公式**：
P(F|J,E) ∝ P(E|J,F) · P(F)

- **似然函数**P(E|J,F)：给定评委分和投票，淘汰结果的概率（约束是否满足）
- **先验分布**P(F)：粉丝投票的先验假设（狄利克雷分布）

**狄利克雷先验**：
P(F|α) = Dir(F; α)

设αi = 1表示无信息先验（均匀分布）；设αi = Ji · N表示信息先验（偏向高分选手）。

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 隐变量估计 | ✅ 贝叶斯推断的强项 |
| 不确定性量化 | ✅ 直接输出后验分布 |
| 单纯形约束 | ✅ 狄利克雷分布天然满足 |
| 多模态分布 | ✅ MCMC可捕捉多峰 |

#### 创新点

1. **狄利克雷先验与投票场景的天然契合**：投票占比本身就是单纯形上的分布，狄利克雷是其共轭先验
2. **不确定性的信息论度量**：引入香农熵 H = -Σ P(F) log P(F) 量化确定性
3. **分层贝叶斯扩展**：将先验参数α也设为随机变量，学习"观众偏好模式"

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 计算量大 | 使用PyMC3/NumPyro加速，采用变分推断近似 |
| MCMC收敛慢 | 多链诊断（Gelman-Rubin统计量R-hat<1.1） |
| 排名制离散化困难 | 使用Gumbel-Softmax松弛技巧 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     贝叶斯MCMC模型应用流程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 数据场景抽象 │────►│ 先验设计    │────►│ 似然函数    │                   │
│  │             │     │             │     │  构建       │                   │
│  │ •贝叶斯框架 │     │ •狄利克雷   │     │             │                   │
│  │ •识别隐变量 │     │  参数选择   │     │ •约束转化   │                   │
│  │ •确定观测量 │     │ •信息/无信息│     │  为概率     │                   │
│  └─────────────┘     └─────────────┘     └─────────────┘                   │
│        │                   │                   │                           │
│        └───────────────────┼───────────────────┘                           │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              概率图模型构建                            │                 │
│  │                                                       │                 │
│  │        α (先验参数)                                   │                 │
│  │            │                                          │                 │
│  │            ▼                                          │                 │
│  │     F ~ Dirichlet(α)  ←── 粉丝投票（隐变量）          │                 │
│  │            │                                          │                 │
│  │            ▼                                          │                 │
│  │     E ~ Bernoulli(σ(rule(J,F)))  ←── 淘汰结果        │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────┐     ┌─────────────────────────────────┐                   │
│  │ MCMC采样    │────►│        收敛诊断                  │                   │
│  │             │     │                                 │                   │
│  │ •NUTS采样器 │     │ R-hat < 1.1 ?                   │                   │
│  │ •4链并行   │     │    │                            │                   │
│  │ •2000样本  │     │    ├──►是：提取后验统计量       │                   │
│  └─────────────┘     │    │                            │                   │
│                      │    └──►否：增加采样/调整先验   │                   │
│                      └─────────────────────────────────┘                   │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 后验分布可视化（投票的概率密度图）                        │           │
│  │  • 点估计（后验均值/MAP）                                    │           │
│  │  • 95%置信区间（Credible Interval）                          │           │
│  │  • 不确定性热力图（标准差/熵）                               │           │
│  │  • MCMC诊断报告（trace plot, R-hat统计量）                   │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、问题二：投票方法比较模型

### 2.1 问题特征分析

| 维度 | 数据特征 | 建模影响 |
|------|----------|----------|
| **问题类型** | 敏感性分析/反事实推演 | 需控制变量实验 |
| **输入** | 问题一的估算投票F_hat | 依赖上游模型 |
| **比较对象** | 排名制 vs 百分比制 | 两种规则函数 |
| **输出** | 方法差异量化、推荐建议 | 统计检验+因果分析 |

---

### 方案一（基础保分）：反事实模拟 + 配对检验

#### 核心原理

反事实分析的核心是**控制变量法**：保持粉丝投票F_hat不变，切换投票规则（排名制↔百分比制），观察淘汰结果的变化。这类似于科学实验中的"平行宇宙"思维——如果历史上采用了不同规则，结果会怎样？

**通俗解释**：想象你有一台时光机，可以回到每一周的比赛，把百分比制换成排名制（或反过来），记录"会发生什么不同"。最后统计这些差异，看哪种规则更"稳定"。

**数学形式**：

对于每周t，计算：
- **原始淘汰者**：Lt_orig = argmin_i Rule_orig(Ji, F_hat_i)
- **反事实淘汰者**：Lt_cf = argmin_i Rule_cf(Ji, F_hat_i)
- **差异指标**：Dt = 1[Lt_orig ≠ Lt_cf]

总体不一致率：Divergence = (1/T)Σ Dt

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 两种明确规则 | ✅ 可精确实现 |
| 历史淘汰记录 | ✅ 提供验证基准 |
| 估算投票数据 | ✅ 作为控制变量 |
| 多季节数据 | ✅ 支持分组分析 |

#### 创新点

1. **配对t检验强化**：不仅计算不一致率，还用配对t检验分析两种方法的系统性偏差
2. **条件分层分析**：按"评委分差距"分层，揭示方法差异在不同竞争激烈度下的表现
3. **偏向性系数**：引入Judge Favorability指标，量化"谁更偏向评委/粉丝"

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 依赖投票估算质量 | 使用置信区间传播，报告敏感性 |
| 仅比较淘汰者 | 扩展为排名相关性分析（Kendall τ） |
| 未考虑时间趋势 | 引入季节固定效应 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     反事实模拟分析流程                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 数据准备    │────►│ 规则实现    │────►│ 反事实计算  │                   │
│  │             │     │             │     │             │                   │
│  │ •加载估算F  │     │ •排名制函数 │     │ •逐周切换   │                   │
│  │ •加载评委J  │     │ •百分比函数 │     │  规则       │                   │
│  │ •标记原规则 │     │ •S28+拯救  │     │ •记录差异   │                   │
│  └─────────────┘     └─────────────┘     └─────────────┘                   │
│        │                                       │                           │
│        └───────────────────────────────────────┘                           │
│                            │                                               │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              统计检验阶段                              │                 │
│  │                                                       │                 │
│  │  1. 计算总体不一致率 Divergence                       │                 │
│  │  2. 配对t检验：H0: μ_rank = μ_percent                 │                 │
│  │  3. McNemar检验：配对分类数据差异                     │                 │
│  │  4. 分层分析：按评委分差距分组                        │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 不一致率统计表（总体/分季节/分阶段）                      │           │
│  │  • 争议案例列表（具体哪些周结果不同）                        │           │
│  │  • Judge Favorability指标                                   │           │
│  │  • 推荐建议报告                                              │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 方案二（创新冲奖）：因果推断 + Bootstrap敏感性分析

#### 核心原理

将方法比较问题提升到**因果推断**层面，使用潜在结果框架（Potential Outcomes Framework）严格定义"方法效应"。同时，通过Bootstrap传播问题一的估算不确定性，得到更稳健的结论。

**通俗解释**：不仅要问"如果换规则会怎样"，还要问"换规则的效果有多大把握是真实的，而不是估算误差导致的假象"。

**因果推断框架**：

定义潜在结果：
- Yi(1)：选手i在排名制下的排名
- Yi(0)：选手i在百分比制下的排名

平均处理效应（ATE）：
ATE = E[Y(1) - Y(0)]

由于每个选手只能在一种规则下被观测，需要用估算投票构建反事实。

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 反事实构建需求 | ✅ 框架支持 |
| 不确定性传播 | ✅ Bootstrap核心优势 |
| 多层次分析 | ✅ 可分选手/周/季节 |

#### 创新点

1. **Rubin因果模型应用**：将投票机制比较纳入严格因果推断框架
2. **不确定性传播**：Bootstrap采样问题一的后验分布，计算ATE的置信区间
3. **异质性处理效应**：分析ATE在不同子群体（如高分选手 vs 低分选手）的差异

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 因果假设较强 | 明确列出SUTVA等假设，讨论违背情况 |
| 计算复杂 | 并行化Bootstrap采样 |
| 理论门槛高 | 在论文中提供直观解释 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     因果推断分析流程                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │              Bootstrap采样循环（B=1000次）                   │           │
│  │                                                             │           │
│  │  For b = 1 to B:                                            │           │
│  │    1. 从问题一后验分布采样 F^(b)                            │           │
│  │    2. 计算排名制下排名 Y^(b)(1)                             │           │
│  │    3. 计算百分比制下排名 Y^(b)(0)                           │           │
│  │    4. 计算 ATE^(b) = mean(Y^(b)(1) - Y^(b)(0))              │           │
│  │                                                             │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                            │                                               │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              统计推断                                  │                 │
│  │                                                       │                 │
│  │  1. ATE点估计 = mean(ATE^(b))                         │                 │
│  │  2. ATE 95% CI = percentile(ATE^(b), [2.5, 97.5])     │                 │
│  │  3. 显著性判断：CI是否包含0？                          │                 │
│  │  4. 异质性分析：分子群体计算CATE                       │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • ATE估计值及95%置信区间                                   │           │
│  │  • Bootstrap分布直方图                                       │           │
│  │  • 子群体异质性分析表                                        │           │
│  │  • 敏感性分析报告（对估算误差的鲁棒性）                      │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、问题三：影响因素分析模型

### 3.1 问题特征分析

| 维度 | 数据特征 | 建模影响 |
|------|----------|----------|
| **问题类型** | 归因分析/回归问题 | 需可解释模型 |
| **自变量** | age, industry, partner, homestate | 混合类型特征 |
| **因变量** | 评委分、估算投票、最终排名 | 多目标分析 |
| **数据结构** | 面板数据（舞伴跨季节） | 需考虑嵌套效应 |

---

### 方案一（基础保分）：线性混合效应模型（LMEM）+ 多重共线性诊断

#### 核心原理

混合效应模型区分**固定效应**（如年龄、行业——每个选手独有）和**随机效应**（如舞伴——跨季节重复出现）。这解决了传统回归中"伪重复"问题：同一个舞伴带不同选手参赛，观测值不独立。

**通俗解释**：想象你要分析"哪个老师教得好"，但不同老师带的学生数量不同、质量不同。混合效应模型能在分析学生成绩时，把"老师效应"单独拎出来，避免把老师的功劳算到学生头上（或反过来）。

**数学形式**：

Y_ij = β0 + β1·age_i + β2·industry_i + u_j + ε_ij

其中：
- Y_ij：选手i（由舞伴j带）的得分
- β：固定效应系数
- u_j ~ N(0, σ_u²)：舞伴随机效应
- ε_ij ~ N(0, σ²)：残差

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 分类变量（industry） | ✅ One-hot编码后作为固定效应 |
| 数值变量（age） | ✅ 直接作为固定效应 |
| 嵌套结构（舞伴） | ✅ 随机效应处理 |
| 多季节数据 | ✅ 可加入季节固定效应 |

#### 创新点

1. **交叉随机效应**：不仅舞伴是随机效应，季节也可以是随机效应（双层嵌套）
2. **多重共线性诊断**：计算VIF（方差膨胀因子），剔除高度相关特征
3. **双因变量对比**：分别以"评委分"和"估算投票"为因变量，比较系数差异

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 线性假设 | 检验残差正态性，必要时Box-Cox变换 |
| 样本量要求（随机效应） | 舞伴至少出现3次才纳入随机效应 |
| 无法处理复杂交互 | 添加交互项（age×industry） |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     混合效应模型应用流程                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 数据预处理  │────►│ 特征工程    │────►│ 多重共线性  │                   │
│  │             │     │             │     │   诊断      │                   │
│  │ •缺失值处理 │     │ •One-hot   │     │             │                   │
│  │ •舞伴编码   │     │  industry  │     │ VIF > 10?   │                   │
│  │ •季节标记   │     │ •年龄标准化│     │ •是：剔除   │                   │
│  └─────────────┘     └─────────────┘     │ •否：保留   │                   │
│                                          └─────────────┘                   │
│                                                 │                          │
│                                                 ▼                          │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              模型拟合                                  │                 │
│  │                                                       │                 │
│  │  模型1: Y = 评委分                                    │                 │
│  │        lmer(score ~ age + industry + (1|partner))     │                 │
│  │                                                       │                 │
│  │  模型2: Y = 估算投票                                  │                 │
│  │        lmer(vote ~ age + industry + (1|partner))      │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                    模型诊断                                  │           │
│  │                                                             │           │
│  │  残差正态性检验 ──► QQ图                                    │           │
│  │       │                                                     │           │
│  │       ├──► 正态：继续                                       │           │
│  │       └──► 非正态：Box-Cox变换                              │           │
│  │                                                             │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 固定效应系数表（含95% CI、p值）                          │           │
│  │  • 随机效应方差分解（舞伴贡献比例）                          │           │
│  │  • 两模型系数对比图（评委 vs 粉丝）                          │           │
│  │  • 边际效应图（年龄的影响曲线）                              │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 方案二（创新冲奖）：XGBoost + SHAP可解释性分析

#### 核心原理

XGBoost是梯度提升树的高效实现，能自动捕捉**非线性关系**和**特征交互**。SHAP（SHapley Additive exPlanations）提供了基于博弈论的特征重要性解释，告诉我们每个特征对每个预测的贡献。

**通俗解释**：XGBoost像一个"聪明的投票系统"——很多棵小树（每棵树是简单规则）一起投票做决定。SHAP则像"功劳分配专家"——告诉你每个因素对最终决定贡献了多少。

**SHAP值公式**：
特征j的贡献是其在所有可能特征子集中的边际贡献的加权平均。

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 混合类型特征 | ✅ XGBoost原生支持 |
| 非线性关系（如年龄U型） | ✅ 树模型天然捕捉 |
| 特征交互 | ✅ SHAP交互图可视化 |
| 中等样本量 | ✅ 早停法防过拟合 |

#### 创新点

1. **双目标对比学习**：分别训练预测"评委分"和"粉丝投票"的模型，比较SHAP值差异
2. **SHAP交互效应**：揭示如"年轻运动员"vs"年长演员"的组合效应
3. **特征依赖图**：展示非线性关系（如年龄可能有最优区间）

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 过拟合风险 | 5折交叉验证+早停 |
| 超参数敏感 | 贝叶斯优化调参 |
| 解释性不如线性模型直观 | SHAP可视化弥补 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     XGBoost + SHAP分析流程                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 特征工程    │────►│ 数据划分    │────►│ 超参数优化  │                   │
│  │             │     │             │     │             │                   │
│  │ •Label编码 │     │ •80%训练   │     │ •Optuna     │                   │
│  │ •缺失值填充 │     │ •20%验证   │     │  贝叶斯优化 │                   │
│  │ •特征交叉   │     │ •5折CV     │     │ •早停轮数   │                   │
│  └─────────────┘     └─────────────┘     └─────────────┘                   │
│                                                 │                          │
│                                                 ▼                          │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              模型训练（双目标）                         │                 │
│  │                                                       │                 │
│  │  Model_J: XGBoost(y=评委分, X=特征)                   │                 │
│  │  Model_F: XGBoost(y=估算投票, X=特征)                 │                 │
│  │                                                       │                 │
│  │  训练曲线监控 ──► 过拟合？                             │                 │
│  │       │                                               │                 │
│  │       ├──► 是：增加正则化/减少深度                    │                 │
│  │       └──► 否：继续训练至早停                         │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              SHAP解释                                  │                 │
│  │                                                       │                 │
│  │  1. 计算SHAP值矩阵                                    │                 │
│  │  2. 生成Summary Plot（特征重要性排序）                │                 │
│  │  3. 生成Dependence Plot（单特征影响曲线）             │                 │
│  │  4. 生成Interaction Plot（交互效应）                  │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • SHAP Summary Plot（评委模型 vs 粉丝模型对比）             │           │
│  │  • 特征依赖图（如年龄-得分关系曲线）                         │           │
│  │  • 交互效应热力图                                            │           │
│  │  • 特征重要性排名表                                          │           │
│  │  • 模型性能指标（RMSE, R²）                                  │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、问题四：新投票系统设计模型

### 4.1 问题特征分析

| 维度 | 数据特征 | 建模影响 |
|------|----------|----------|
| **问题类型** | 机制设计/多目标优化 | 需平衡多个目标 |
| **设计目标** | 公平性、娱乐性、可操作性 | 多目标权衡 |
| **验证数据** | 历史34季数据 | 回溯测试 |
| **约束** | 规则需简单可解释 | 避免过度复杂 |

---

### 方案一（基础保分）：参数化动态权重 + 网格搜索优化

#### 核心原理

设计一个**时间依赖的权重函数**w(t)，控制评委分与粉丝投票的相对重要性。通过网格搜索在历史数据上找到最优参数，使得"争议率"最低。

**通俗解释**：就像调节音响的"高低音平衡"——比赛前期多听评委的（筛选技术差的），后期多听观众的（增加悬念）。我们要找到最佳的"调节旋钮"位置。

**权重函数设计**：

w(t) = w_start + (w_end - w_start) · (t - 1)/(T - 1)

其中t为当前周数，T为总周数。需优化参数(w_start, w_end)。

**优化目标**：

min ControversyRate(w) + λ · Complexity(w)

争议率定义为"评委分最低者夺冠"的比例。

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 历史回溯数据 | ✅ 充足验证样本 |
| 简单规则需求 | ✅ 线性权重易解释 |
| 多目标平衡 | ✅ 可加权组合 |

#### 创新点

1. **分段线性扩展**：允许多个拐点，如"前期-中期-后期"三段不同斜率
2. **争议案例加权**：对历史争议案例（Bobby Bones等）的误判给予更高惩罚
3. **稳定性约束**：要求连续两周权重变化不超过阈值

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| 网格搜索效率低 | 贝叶斯优化替代 |
| 可能过拟合历史 | 留一季交叉验证 |
| 线性假设过强 | 扩展为非线性（Sigmoid） |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     动态权重系统设计流程                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 定义目标    │────►│ 参数空间    │────►│ 网格搜索    │                   │
│  │             │     │             │     │             │                   │
│  │ •争议率最小 │     │ w_start     │     │ •遍历参数   │                   │
│  │ •保持悬念   │     │   [0.3,0.7] │     │ •计算目标   │                   │
│  │ •规则简单   │     │ w_end       │     │ •记录最优   │                   │
│  └─────────────┘     │   [0.3,0.7] │     └─────────────┘                   │
│                      └─────────────┘           │                           │
│                                                ▼                           │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              历史回溯验证                              │                 │
│  │                                                       │                 │
│  │  For each (w_start, w_end):                           │                 │
│  │    1. 应用新规则于S1-S34                              │                 │
│  │    2. 计算每季"新冠军"的评委排名                      │                 │
│  │    3. 统计争议率 = 评委分末3名夺冠比例                │                 │
│  │    4. 计算悬念指标 = 最后一周前3名竞争激烈度          │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              结果筛选                                  │                 │
│  │                                                       │                 │
│  │  争议率 < 10% ?                                       │                 │
│  │       │                                               │                 │
│  │       ├──► 是：检查悬念指标                           │                 │
│  │       │         │                                     │                 │
│  │       │         ├──► 悬念OK：选为候选方案             │                 │
│  │       │         └──► 悬念差：调整参数                 │                 │
│  │       │                                               │                 │
│  │       └──► 否：扩大搜索范围                           │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 最优参数 (w_start*, w_end*)                              │           │
│  │  • 权重曲线可视化                                            │           │
│  │  • 争议率对比表（新系统 vs 历史系统）                        │           │
│  │  • 敏感性分析（参数微调对结果影响）                          │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 方案二（创新冲奖）：多目标优化 + 帕累托前沿分析

#### 核心原理

将系统设计建模为**多目标优化问题**，同时优化"专业性"（评委权重）、"民意性"（粉丝权重）、"悬念性"（结果不确定性）三个目标。使用NSGA-II算法找到帕累托最优解集。

**通俗解释**：想象你要设计一款汽车，要同时考虑"速度快"、"油耗低"、"价格便宜"。这三个目标往往冲突——速度快通常油耗高。帕累托前沿就是找到所有"不能在不牺牲某个目标的情况下改进另一个目标"的方案集合。

**多目标优化问题**：

目标向量：
- f1(θ) = -corr(FinalRank, J)  -- 专业性
- f2(θ) = -corr(FinalRank, F)  -- 民意性
- f3(θ) = -Entropy(Result)     -- 悬念性

约束：θ ∈ Θ（参数合理范围）

#### 适配性分析

| 数据特征 | 模型适配 |
|----------|----------|
| 多目标冲突 | ✅ 帕累托框架核心优势 |
| 连续参数空间 | ✅ 进化算法处理 |
| 需可视化决策 | ✅ 帕累托前沿直观 |

#### 创新点

1. **三目标帕累托**：突破传统"公平vs娱乐"二元对立，引入"悬念"第三维度
2. **交互式决策支持**：生成帕累托前沿后，允许决策者选择偏好点
3. **鲁棒性优化**：在帕累托最优中选择对参数扰动最不敏感的解

#### 局限性与规避

| 局限性 | 规避方案 |
|--------|----------|
| NSGA-II计算慢 | 多进程并行评估 |
| 高维帕累托难可视化 | 降维投影+雷达图 |
| 选择最终方案主观 | 提供多个推荐点 |

#### 可视化流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     多目标优化设计流程                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │ 定义目标    │────►│ 定义参数    │────►│ NSGA-II     │                   │
│  │             │     │             │     │   优化      │                   │
│  │ f1:专业性   │     │ •w(t)参数   │     │             │                   │
│  │ f2:民意性   │     │ •门槛参数   │     │ •种群100    │                   │
│  │ f3:悬念性   │     │ •拯救规则   │     │ •代数200    │                   │
│  └─────────────┘     └─────────────┘     └─────────────┘                   │
│                                                 │                          │
│                                                 ▼                          │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              适应度评估（历史数据回溯）                 │                 │
│  │                                                       │                 │
│  │  For each individual θ in population:                 │                 │
│  │    1. 应用规则 θ 于 S1-S34                            │                 │
│  │    2. 计算 f1 = -corr(FinalRank, JudgeScore)          │                 │
│  │    3. 计算 f2 = -corr(FinalRank, FanVote)             │                 │
│  │    4. 计算 f3 = -Entropy(WeeklyElimination)           │                 │
│  │    5. 返回 fitness = (f1, f2, f3)                     │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌───────────────────────────────────────────────────────┐                 │
│  │              帕累托前沿提取                            │                 │
│  │                                                       │                 │
│  │       f1(专业性)                                      │                 │
│  │          ^                                            │                 │
│  │          │    * <-- 帕累托最优解                      │                 │
│  │          │  *   *                                     │                 │
│  │          │    *   *                                   │                 │
│  │          │      *   *                                 │                 │
│  │          │        *                                   │                 │
│  │          └──────────────► f2(民意性)                  │                 │
│  │                                                       │                 │
│  └───────────────────────────────────────────────────────┘                 │
│                            │                                               │
│                            ▼                                               │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                        输出物                                │           │
│  │  • 帕累托前沿可视化（3D散点图/雷达图）                       │           │
│  │  • 推荐方案列表（专业优先/民意优先/平衡型）                  │           │
│  │  • 方案对比表（各目标值+参数设置）                           │           │
│  │  • 敏感性分析（参数扰动对帕累托位置影响）                    │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、模型选择总览表

| 小问 | 方案一（基础保分） | 方案二（创新冲奖） | 推荐优先级 |
|------|-------------------|-------------------|-----------|
| **Q1: 投票估算** | 约束优化+先验正则化 | 贝叶斯MCMC+狄利克雷 | Q1为核心，建议双方案实现 |
| **Q2: 方法比较** | 反事实模拟+配对检验 | 因果推断+Bootstrap | 方案一优先，时间充裕上方案二 |
| **Q3: 影响分析** | 混合效应模型 | XGBoost+SHAP | 建议双方案对比呈现 |
| **Q4: 系统设计** | 动态权重+网格搜索 | 多目标优化+帕累托 | 方案一保底，方案二冲奖 |

---

## 六、模型实现技术栈

### 6.1 Python库推荐

| 任务 | 基础方案 | 创新方案 |
|------|----------|----------|
| 约束优化 | cvxpy + ECOS | - |
| 贝叶斯推断 | - | PyMC3 / NumPyro |
| 统计检验 | scipy.stats | - |
| 混合效应模型 | statsmodels | - |
| XGBoost | - | xgboost + shap |
| 多目标优化 | - | pymoo (NSGA-II) |
| 可视化 | matplotlib | plotly (交互式) |

### 6.2 关键代码框架

```python
# 问题一：约束优化
import cvxpy as cp
def estimate_votes(judge_scores, eliminated_idx):
    n = len(judge_scores)
    F = cp.Variable(n, nonneg=True)
    constraints = [cp.sum(F) == 1]
    # 添加淘汰约束...
    prob = cp.Problem(cp.Minimize(cp.sum_squares(F - prior)), constraints)
    prob.solve()
    return F.value

# 问题三：混合效应模型
import statsmodels.formula.api as smf
model = smf.mixedlm("score ~ age + C(industry)", data, groups="partner")
result = model.fit()

# 问题四：多目标优化
from pymoo.algorithms.moo.nsga2 import NSGA2
from pymoo.optimize import minimize
res = minimize(problem, NSGA2(pop_size=100), ('n_gen', 200))
```

---

## 七、时间分配建议

| 模型任务 | 基础方案耗时 | 创新方案额外耗时 | 建议 |
|----------|-------------|-----------------|------|
| Q1模型 | 6h | +8h | **必做双方案** |
| Q2模型 | 4h | +6h | 基础必做，创新可选 |
| Q3模型 | 4h | +6h | 建议双方案 |
| Q4模型 | 4h | +8h | 时间紧只做基础 |
| **总计** | **18h** | **+28h** | 根据进度灵活调整 |

---

**文档版本**: 1.0  
**生成日期**: 2026-01-30  
**适用竞赛**: MCM 2026 Problem C
